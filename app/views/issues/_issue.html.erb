<div class="card-issue pop-up-element"  data-id="<%= issue.id %>">
    <div class="card-issue__engine">
        <%= issue.engine.name %>
    </div>
    <div class="card-issue__content">
        <div class="card-issue__metas">
            <div class="card-issue__name"><%= issue.name %><hr></div>       
        </div>
        <% if issue.start_date %>
        <div class="card-issue__datetime">
            <span><%= fa_icon "calendar" %> <%= issue.start_date.strftime('%d.%m.%y') %></span>
            <span><%= fa_icon "history" %> <%= issue.start_date.strftime('%Hh%M') %></span>
        </div>
        <% end %>

        <div class="card-issue__desc">
            <span>Message :</span>
            <% if issue.info %>
            <div><%= strip_tags(issue.info.to_s).truncate(60) %></div>
            <% else %>
            <div>N/A</div>
            <% end %>
        </div>

        <div class="card-issue__btn d-flex justify-content-between">
            <a class="js-pop-open action-btn__small" data-name="detail-<%= issue.id %>"><%= fa_icon "list" %>  Voir le détail</a>

            <% if issue.status == "encours" %>
                <%= link_to edit_issue_path(issue), class: "action-btn__small up-issue" do %>
                <%= fa_icon "check" %>  Résoudre   
                <% end %>
            <% end %>
            

            <% if issue.status == "resolu" %>
            <span class="ar-issue action-btn__small white" data-id="<%= issue.id %>"><%= fa_icon "archive" %> Archiver</span>
            <% end %>
            
        </div> 
    </div>

    <%# Pop Up Detail Issue %>
    <div class="js-screen-open" data-open="detail-<%= issue.id %>">
        <div class="js-screen__inner">
            <span class="js-screen__close"><%= fa_icon "times-circle" %></span>
            <div class="js-screen__pop pop-up-issue">
                <div class="pop-up-issue__inner">
                    <div class="pop-up-issue__heading">
                        <%= issue.name %>
                    </div>
                    <div class="pop-up-issue__engine">
                        <%= issue.engine.name %>
                    </div>
                    <div class="pop-up-issue__metas">
                        <% if issue.start_date %>
                        <div class="pop-up-issue__date">
                            <span><%= fa_icon "calendar" %> <%= issue.start_date.strftime('%d.%m.%y') %></span>
                            <span><%= fa_icon "history" %> <%= issue.start_date.strftime('%Hh%M') %></span>
                        </div>
                        <% end %>
                    </div>
                    <div class="pop-up-issue__info">
                        <div class="pop-up-issue__info-title">Message :</div>
                        <%= issue.info %>
                    </div>
                    <% if issue.user_id %>
                    <div class="pop-up-issue__user">
                        <div class="pop-up-issue__user-avatar">
                            <img src="<%= issue.user.picture_url%>">
                        </div>
                        <span><%= issue.user.firstname %><br><%= issue.user.lastname %></span>
                    </div>
                    <% end %>
                    <div class="pop-up-issue__number">
                        Incident n°<%= issue.id %>
                    </div>
                </div>
            </div>        
        </div>
    </div>

    <%# Pop Up Validation Update to resolved%>
    <div class="js-screen-open" data-open="update-<%= issue.id %>">
        <div class="js-screen__inner">
            <span class="js-screen__close"><%= fa_icon "times-circle" %></span>
            <div class="js-screen__pop pop-up-issue-update">
                <div class="pop-up-issue-update__inner">
                    <div class="pop-up-issue-update__heading">
                        <%= fa_icon "exclamation-circle" %>
                        Résolution de l'incident
                    </div>
                    <div class="pop-up-issue-update__txt">
                        Avant de pouvoir valider la résolution, veuillez téléverser la fiche d'incident.
                    </div>
                    <div class="pop-up-issue-update__form">
                        <div class="form-lay1">
                          <form id="updateIssue" onsubmit="AJAXSubmit(this); return false;">
                            <div class="form-lay1__fields d-flex justify-content-between">
                              <div class="form-lay1__input file full border-box">
                                <input type="file" name="issue[validation_file]" id="issue_validation_file" required>
                                <label for="issue_validation_file" data-before="Ajouter le fichier"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="17" viewBox="0 0 20 17"><path d="M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"></path></svg><span class="file-name">Ajouter le fichier</span></label>
                            </div>
                        </div>   
                        <div class="form-lay1__action">
                          <input type="submit" disabled value="Résoudre l'incident" name="commit">
                      </div>
                  </form>  
              </div>         
          </div>
      </div>
  </div>        
</div>
</div>
</div>


